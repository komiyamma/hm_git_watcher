<!DOCTYPE html>
<html lang="ja">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HmGitWatcher</title>
<style>
body {
    margin: 0;
    padding: 0;
}

.command-button {
    opacity: 0.2; /* デフォルトの透明度 */
    width: 34px;
    height: 34px;
    padding: 0;
    border: none;
    background-color: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
}

.command-button img {
    max-width: 30px;
    height: 30px;
    display: block;
}

.command-button.active {
    opacity: 1.0; /* アクティブ時の透明度 */
    cursor: pointer;
    
}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const callFuncId = Number(urlParams.get('callFuncId'));

    const pullButton = document.getElementById('pull_all');
    const commitButton = document.getElementById('commit_all');
    const pushButton = document.getElementById('push_all');
    const openVscodeButton = document.getElementById('open_vscode');

    function HmGitWatcher_sendMessageToWebView(message) {
        window.chrome.webview.postMessage({ funcid: callFuncId, message: message });
    }

    function HmGitWatcher_updateButtonState(gitStatus, gitStatusPorchain, gitCherry) {
        pullButton?.classList.toggle('active', gitStatus > 0);
        commitButton?.classList.toggle('active', gitStatusPorchain > 0);
        pushButton?.classList.toggle('active', gitCherry > 0);
        openVscodeButton?.classList.add('active');
    }

    window.HmGitWatcher_Update = HmGitWatcher_updateButtonState;

    function handleButtonClick(buttonId) {
        HmGitWatcher_sendMessageToWebView(buttonId);
    }

    document.querySelectorAll('.command-button').forEach(button => {
        button.addEventListener('click', () => { handleButtonClick(button.id) });
    });

    const bgcolor = urlParams.get('bgcolor');
    if (bgcolor) {
        document.body.style.backgroundColor = "#" + bgcolor;
    }
});
</script>
</head>

<body>
    <button id="pull_all" class="command-button" type="button" role="button">
        <img src="./icon/icon_pull.png" alt="全てプル">
    </button>
    <button id="commit_all" class="command-button" type="button" role="button">
        <img src="./icon/icon_commit.png" alt="全てコミット">
    </button>
    <button id="push_all" class="command-button" type="button" role="button">
        <img src="./icon/icon_push.png" alt="全てプッシュ">
    </button>
    <button id="open_vscode" class="command-button active" type="button" role="button">
        <img src="./icon/icon_vsc.png" alt="VSCodeを起動">
    </button>
</body>

</html>